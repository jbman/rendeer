//
// Rendeer content rendering engine
//
// Uses Showdown to render HTML from markdown.

window.onload = start;

console.debug("rendeer");

// Check for the various File API support.
if (window.File && window.FileReader && window.FileList && window.Blob) {
  console.debug("All the File APIs are supported.");
} else {
  alert('The File APIs are not fully supported in this browser.');
}

function start() {
  console.debug("start");

//  markdownHtml = document.getElementById("markdownHtml");

  converter = new Showdown.converter();
  var fConvert = function(data, targetElement) {
        htmlText = converter.makeHtml(data);
        targetElement.innerHTML = htmlText;
  };

  var fLoadAndRender = function(fileUrl, targetElement) {
      console.debug('fLoadAndRender(%s, %s)', fileUrl, targetElement);

      var fSuccess = function(data) {
         console.debug('fSuccess(%s)', targetElement);
         fConvert(data, targetElement);
      };
      $.ajax({
      url: fileUrl,
      dataType: 'text',
      success: fSuccess
    });
  };

  $('.rendeer').each(function(index) {
    hrefVal = $(this).attr("href");
    console.debug("Load and render file " + hrefVal);
    console.debug($(this));
    fLoadAndRender(hrefVal, this);
  });


}

